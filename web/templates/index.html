<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>每日选股结果</title>
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body>
<h2>每日选股结果</h2>
<ul id="stock-list"></ul>

<h2>历史趋势图</h2>
<div id="chart" style="width:800px;height:400px;"></div>

<script>
async function fetchData() {
    const res = await fetch("/api/stocks");
    const data = await res.json();

    // 显示股票列表
    const ul = document.getElementById("stock-list");
    ul.innerHTML = "";
    data.forEach(stock => {
        const li = document.createElement("li");
        li.textContent = stock.Code;
        ul.appendChild(li);
    });

    // 绘制趋势图（取第一只股票为示例）
    if(data.length > 0) {
        const closes = data[0].Close;
        const ma20 = [];
        for(let i=0;i<closes.length;i++){
            if(i<20) ma20.push(null);
            else {
                let sum=0;
                for(let j=i-20;j<i;j++) sum+=closes[j];
                ma20.push(sum/20);
            }
        }
        const chart = echarts.init(document.getElementById('chart'));
        const option = {
            xAxis: {type:'category', data: closes.map((_,i)=>i+1)},
            yAxis: {type:'value'},
            series: [
                {name:'收盘价', type:'line', data: closes},
                {name:'20日均线', type:'line', data: ma20}
            ]
        };
        chart.setOption(option);
    }
}
fetchData();
setInterval(fetchData, 60000); // 每分钟刷新
</script>
</body>
</html>
